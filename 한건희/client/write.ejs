<!-- write.html -->
<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>ê²Œì‹œë¬¼ ì‘ì„±</title>
    <link rel="stylesheet" href="/css/style.css" />
  </head>
  <body>
    <h1>ê²Œì‹œë¬¼ ì‘ì„±</h1>
    <form id="postForm">
      <label>ì œëª©</label><br />
      <input type="text" id="title" name="title" /><br /><br />

      <label>ë‚´ìš©</label><br />
      <textarea id="content" name="content" rows="10" required></textarea
      ><br /><br />

      <button type="submit">ì‘ì„±í•˜ê¸°</button>
    </form>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const form = document.querySelector("#postForm");

        form.addEventListener("submit", async (e) => {
          e.preventDefault();

          const title = document.querySelector("#title").value.trim();
          const content = document.querySelector("#content").value.trim();

          try {
            const res = await fetch("/api/v1/posts", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({ title, content }),
            });

            const result = await res.json(); // í•­ìƒ ë¨¼ì € íŒŒì‹±

            if (!res.ok) {
              // ğŸ”¥ 403, 400 ë“± ì˜¤ë¥˜ ì‘ë‹µ ì²˜ë¦¬
              alert(`âŒ ë“±ë¡ ì‹¤íŒ¨: ${result.message || "ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜"}`);
              return;
            }

            // âœ… ì„±ê³µ ì²˜ë¦¬
            alert("âœ… ë“±ë¡ ì™„ë£Œ!");
            location.href = "/";
          } catch (err) {
            console.error("ì—ëŸ¬ ë°œìƒ:", err);
            alert("âš ï¸ ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
          }
        });
      });

      // âœ… res.ok ì„¤ëª…
      // res.okëŠ” ìƒíƒœì½”ë“œê°€ 200~299ì¼ ë•Œë§Œ true
      // 403, 400, 500 ë“±ì€ ì „ë¶€ false
      // ê·¸ë˜ì„œ !res.ok ì²´í¬ë¡œ ì‹¤íŒ¨ ë¡œì§ ë‹¤ ì»¤ë²„ ê°€ëŠ¥í•¨
    </script>
  </body>
</html>
